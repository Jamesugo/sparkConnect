<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up - SparkConnect</title>
    <link rel="stylesheet" href="css/style.css" />
    <style>
      .login-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        background-color: #eef2f6;
        padding: var(--spacing-md);
      }

      .login-card {
        background-color: var(--white);
        border-radius: var(--radius-lg);
        padding: var(--spacing-xxl);
        width: 100%;
        max-width: 500px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }

      .login-header {
        margin-bottom: var(--spacing-xl);
        text-align: center;
      }

      .login-header h1 {
        font-size: var(--font-size-2xl);
        font-weight: 700;
        color: var(--text-dark);
        margin-bottom: var(--spacing-md);
      }

      .form-group {
        margin-bottom: var(--spacing-lg);
      }

      .form-group label {
        display: block;
        margin-bottom: var(--spacing-sm);
        font-weight: 500;
        color: var(--text-dark);
      }

      .form-actions {
        margin-top: var(--spacing-xl);
      }

      .btn-full {
        width: 100%;
        padding: var(--spacing-md);
        font-size: var(--font-size-base);
      }

      .toggle-auth {
        margin-top: var(--spacing-md);
        text-align: center;
        font-size: var(--font-size-sm);
        color: var(--text-gray);
      }

      .toggle-auth a {
        color: var(--primary-blue);
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <!-- Nav rendered by js/nav.js -->
    <nav></nav>

    <div class="login-container">
      <div class="login-card">
        <div class="login-header">
          <h1>Create Account</h1>
          <p style="color: var(--text-gray)">Join SparkConnect today</p>
        </div>

        <div
          id="signup-error"
          class="hidden"
          style="
            color: #721c24;
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            margin-bottom: 20px;
          "
        ></div>

        <form id="signup-form">
          <div class="form-group">
            <label for="name">Full Name</label>
            <input type="text" id="name" placeholder="John Doe" required />
          </div>

          <div class="form-group">
            <label for="email">Email Address</label>
            <input
              type="email"
              id="email"
              placeholder="you@example.com"
              required
            />
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <input
              type="password"
              id="password"
              placeholder="••••••••"
              required
            />
          </div>

          <div class="form-group">
            <label for="specialty">I am a...</label>
            <select id="specialty" required>
              <option value="Visitor">Visitor / Homeowner</option>
              <option value="Residential Wiring">
                Residential Electrician
              </option>
              <option value="Commercial Systems">Commercial Electrician</option>
              <option value="Industrial Maintenance">
                Industrial Electrician
              </option>
              <option value="Solar Installation">Solar Installer</option>
            </select>
          </div>

          <div class="form-group">
            <label for="state">Location (State)</label>
            <select id="state" required>
              <!-- Populated via JS -->
              <option value="Lagos">Lagos</option>
            </select>
          </div>

          <div class="form-actions">
            <button type="submit" class="btn btn-primary btn-full">
              Sign Up
            </button>
          </div>
        </form>

        <div
          style="
            margin: 20px 0;
            text-align: center;
            color: #888;
            font-size: 0.9rem;
          "
        >
          Or continue with
        </div>

        <div
          style="
            display: flex;
            justify-content: center;
            margin-bottom: 2rem;
            margin-top: 2rem;
          "
        >
          <!-- Google Sign-In Button Container -->
          <div
            id="g_id_onload"
            data-client_id="1033822674322-4e9qr40dt8092qjvqqh0n16sjup4tbek.apps.googleusercontent.com"
            data-context="signup"
            data-ux_mode="popup"
            data-callback="handleCredentialResponse"
            data-auto_prompt="false"
          ></div>

          <div
            class="g_id_signin"
            data-type="standard"
            data-shape="rectangular"
            data-theme="outline"
            data-text="signup_with"
            data-size="large"
            data-logo_alignment="left"
          ></div>
        </div>

        <div class="toggle-auth">
          Already have an account? <a href="login.html">Sign In</a>
        </div>
      </div>
    </div>

    <script src="js/data.js?v=FIX_AUTH_1"></script>
    <script src="js/nav.js"></script>
    <script>
      // Populate states
      const stateSelect = document.getElementById("state");
      if (typeof NIGERIAN_STATES !== "undefined") {
        stateSelect.innerHTML = NIGERIAN_STATES.map(
          (s) => `<option value="${s}">${s}</option>`,
        ).join("");
        stateSelect.value = "Lagos";
      }

      // Signup Handler
      document
        .getElementById("signup-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const btn = e.target.querySelector('button[type="submit"]');
          const originalText = btn.innerText;
          btn.innerText = "Creating Account...";
          btn.disabled = true;

          const data = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            password: document.getElementById("password").value,
            specialty: document.getElementById("specialty").value,
            state: document.getElementById("state").value,
          };

          try {
            await DataManager.signup(data);
            window.location.href = "dashboard.html";
          } catch (error) {
            alert("Signup failed: " + error.message);
            btn.innerText = originalText;
            btn.disabled = false;
          }
        });

      // Google Auth callback (Handles both signup and login)
      async function handleCredentialResponse(response) {
        try {
          const res = await DataManager.googleLogin(response.credential);
          if (res.user) {
            if (res.is_new) {
              window.location.href = "dashboard.html";
            } else {
              // If they chose signup but already have an account, just log them in
              window.location.href = "index.html";
            }
          }
        } catch (e) {
          alert("Google Auth failed: " + e.message);
        }
      }
    </script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
  </body>
</html>
